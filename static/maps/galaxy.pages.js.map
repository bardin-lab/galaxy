{"version":3,"sources":["galaxy.pages.js"],"names":["get_item_info","range","item_plural","selection","dialog_type","CONTROLS","ITEM_HISTORY","item_singular","item_controller","item_class","toLowerCase","controller","iclass","list_ajax_url","list_objects_url","replace","item_list_action","make_item_importable","item_id","item_type","ajax_url","set_accessible_url","singular","plural","alert","editor","items","message","x","responseText","statusText","make_popupmenu","show_modal","Ignore error","hide_modal","$","wymeditor","skin","basePath","editor_base_path","iframeBasePath","iframe_base_path","WYMeditor","TOOLS","IFRAME","toolsItems","name","title","css","DIALOG_DATASET_LINK","dialog","_localization2","default","embed_object_button","DIALOG_EMBED_HISTORY","DIALOG_EMBED_DATASET","wymeditors","ajax","url","save_url","type","data","id","page_id","content","xhtml","annotations","JSON","stringify","Object","_","success","callback","click","save","window","document","location","page_list_url","containers_menu","append","each","_options","containersItems","k","v","tagname","container","insert_link_menu_button","addClass","Insert History Link","DIALOG_HISTORY_LINK","Insert Dataset Link","Insert Workflow Link","DIALOG_WORKFLOW_LINK","Insert Page Link","DIALOG_PAGE_LINK","Insert Visualization Link","DIALOG_VISUALIZATION_LINK","Embed History","Embed Dataset","Embed Workflow","DIALOG_EMBED_WORKFLOW","Embed Visualization","DIALOG_EMBED_VISUALIZATION","ITEM_DATASET","ITEM_WORKFLOW","ITEM_PAGE","ITEM_VISUALIZATION","DIALOG_EMBED_PAGE","prototype","dialogType","dialogFeatures","bodyHtml","wym","DIALOG_LINK","selected","attribute_input","val","removeClass","HREF","SRC","titleSelector","attr","TITLE","altSelector","ALT","curURL","hrefSelector","srcSelector","curTitle","undefined","sUrl","sId","_exec","CREATE_LINK","sStamp","_doc","body","sName","link","text","indexOf","uniqueStamp","this","remove","DIALOG_IMAGE","_selected_image","dialogImageSelector","Insert","iRows","iCols","INSERT_IMAGE","table","createElement","newRow","newCol","Cancel","DIALOG_TABLE","item_info","rowsSelector","colsSelector","TABLE","captionSelector","createCaption","insertRow","y","insertCell","show","summarySelector","closing_events","findUp","MAIN_CONTAINERS","get","node","parentNode","after","getJSON","link_text","Galaxy","Close","grid","_gridView2","url_base","embedded","modal","buttons","Array","get_name_and_link_url","Embed","returned_item_info","make_importable","insert","item_embed_html","hide","ajaxError","boxHtml","$el","item_name","do_close","onbeforeunload"],"mappings":"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","file":"../scripts/galaxy.pages.js","sourcesContent":["import _l from \"utils/localization\";\nimport \"libs/jquery/jquery.form\";\nimport \"libs/jquery/jstorage\";\nimport \"libs/jquery/jquery.wymeditor\";\nimport \"libs/jquery/jquery.autocomplete\";\nimport GridView from \"mvc/grid/grid-view\";\n\nvar WYMeditor = window.WYMeditor;\n\nvar CONTROLS = {\n    // Item types.\n    ITEM_HISTORY: \"item_history\",\n    ITEM_DATASET: \"item_dataset\",\n    ITEM_WORKFLOW: \"item_workflow\",\n    ITEM_PAGE: \"item_page\",\n    ITEM_VISUALIZATION: \"item_visualization\",\n\n    // Link dialogs.\n    DIALOG_HISTORY_LINK: \"link_history\",\n    DIALOG_DATASET_LINK: \"link_dataset\",\n    DIALOG_WORKFLOW_LINK: \"link_workflow\",\n    DIALOG_PAGE_LINK: \"link_page\",\n    DIALOG_VISUALIZATION_LINK: \"link_visualization\",\n\n    // Embed dialogs.\n    DIALOG_EMBED_HISTORY: \"embed_history\",\n    DIALOG_EMBED_DATASET: \"embed_dataset\",\n    DIALOG_EMBED_WORKFLOW: \"embed_workflow\",\n    DIALOG_EMBED_PAGE: \"embed_page\",\n    DIALOG_EMBED_VISUALIZATION: \"embed_visualization\"\n};\n\n// Initialize Galaxy elements.\nfunction init_galaxy_elts(wym) {\n    // Set up events to make annotation easy.\n    $(\".annotation\", wym._doc.body).each(function() {\n        $(this).click(function() {\n            // Works in Safari, not in Firefox.\n            var range = wym._doc.createRange();\n            range.selectNodeContents(this);\n            var selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            var t = \"\";\n        });\n    });\n}\n\n// Based on the dialog type, return a dictionary of information about an item\nfunction get_item_info(dialog_type) {\n    var item_singular;\n    var item_plural;\n    var item_controller;\n    var item_class;\n    switch (dialog_type) {\n        case CONTROLS.ITEM_HISTORY:\n            item_singular = \"History\";\n            item_plural = \"Histories\";\n            item_controller = \"history\";\n            item_class = \"History\";\n            break;\n        case CONTROLS.ITEM_DATASET:\n            item_singular = \"Dataset\";\n            item_plural = \"Datasets\";\n            item_controller = \"dataset\";\n            item_class = \"HistoryDatasetAssociation\";\n            break;\n        case CONTROLS.ITEM_WORKFLOW:\n            item_singular = \"Workflow\";\n            item_plural = \"Workflows\";\n            item_controller = \"workflow\";\n            item_class = \"StoredWorkflow\";\n            break;\n        case CONTROLS.ITEM_PAGE:\n            item_singular = \"Page\";\n            item_plural = \"Pages\";\n            item_controller = \"page\";\n            item_class = \"Page\";\n            break;\n        case CONTROLS.ITEM_VISUALIZATION:\n            item_singular = \"Visualization\";\n            item_plural = \"Visualizations\";\n            item_controller = \"visualization\";\n            item_class = \"Visualization\";\n            break;\n    }\n\n    // Build ajax URL that lists items for selection.\n    var item_list_action = `list_${item_plural.toLowerCase()}_for_selection`;\n    var ajax_url = list_objects_url.replace(\"LIST_ACTION\", item_list_action);\n\n    // Set up and return dict.\n    return {\n        singular: item_singular,\n        plural: item_plural,\n        controller: item_controller,\n        iclass: item_class,\n        list_ajax_url: ajax_url\n    };\n}\n\n// Make an item importable.\nfunction make_item_importable(item_controller, item_id, item_type) {\n    var ajax_url = set_accessible_url.replace(\"ITEM_CONTROLLER\", item_controller);\n    $.ajax({\n        type: \"POST\",\n        url: ajax_url,\n        data: { id: item_id, accessible: \"True\" },\n        error: function() {\n            alert(`Making ${item_type} accessible failed`);\n        }\n    });\n}\n\n// Completely replace WYM's dialog handling\nWYMeditor.editor.prototype.dialog = function(dialogType, dialogFeatures, bodyHtml) {\n    var wym = this;\n    var sStamp = wym.uniqueStamp();\n    var selected = wym.selected();\n\n    // Swap out URL attribute for id/name attribute in link creation to enable anchor creation in page.\n    function set_link_id() {\n        // When \"set link id\" link clicked, update UI.\n        $(\"#set_link_id\").click(function() {\n            // Set label.\n            $(\"#link_attribute_label\").text(\"ID/Name\");\n\n            // Set input elt class, value.\n            var attribute_input = $(\".wym_href\");\n            attribute_input.addClass(\"wym_id\").removeClass(\"wym_href\");\n            if (selected) attribute_input.val($(selected).attr(\"id\"));\n\n            // Remove link.\n            $(this).remove();\n        });\n    }\n\n    // LINK DIALOG\n    if (dialogType == WYMeditor.DIALOG_LINK) {\n        if (selected) {\n            $(wym._options.hrefSelector).val($(selected).attr(WYMeditor.HREF));\n            $(wym._options.srcSelector).val($(selected).attr(WYMeditor.SRC));\n            $(wym._options.titleSelector).val($(selected).attr(WYMeditor.TITLE));\n            $(wym._options.altSelector).val($(selected).attr(WYMeditor.ALT));\n        }\n\n        // Get current URL, title.\n        var curURL;\n\n        var curTitle;\n        if (selected) {\n            curURL = $(selected).attr(\"href\");\n            if (curURL == undefined) curURL = \"\";\n            curTitle = $(selected).attr(\"title\");\n            if (curTitle == undefined) curTitle = \"\";\n        }\n        show_modal(\n            \"Create Link\",\n            `<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='${curURL}' size='40' /></div><div><label>Title</label><br><input type='text' class='wym_title' value='${curTitle}' size='40' /></div><div>`,\n            {\n                \"Make link\": function() {\n                    // Get URL, name/title.\n                    var sUrl = $(wym._options.hrefSelector).val() || \"\";\n\n                    var sId = $(\".wym_id\").val() || \"\";\n                    var sName = $(wym._options.titleSelector).val() || \"\";\n\n                    if (sUrl || sId) {\n                        // Create link.\n                        wym._exec(WYMeditor.CREATE_LINK, sStamp);\n\n                        // Set link attributes.\n                        var link = $(`a[href=${sStamp}]`, wym._doc.body);\n                        link\n                            .attr(WYMeditor.HREF, sUrl)\n                            .attr(WYMeditor.TITLE, sName)\n                            .attr(\"id\", sId);\n\n                        // If link's text is default (wym-...), change it to the title.\n                        if (link.text().indexOf(\"wym-\") === 0) {\n                            link.text(sName);\n                        }\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            },\n            {},\n            set_link_id\n        );\n    }\n\n    // IMAGE DIALOG\n    if (dialogType == WYMeditor.DIALOG_IMAGE) {\n        if (wym._selected_image) {\n            $(`${wym._options.dialogImageSelector} ${wym._options.srcSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.SRC)\n            );\n            $(`${wym._options.dialogImageSelector} ${wym._options.titleSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.TITLE)\n            );\n            $(`${wym._options.dialogImageSelector} ${wym._options.altSelector}`).val(\n                $(wym._selected_image).attr(WYMeditor.ALT)\n            );\n        }\n        show_modal(\n            \"Image\",\n            \"<div class='row'>\" +\n                \"<label>URL</label><br>\" +\n                \"<input type='text' class='wym_src' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Alt text</label><br>\" +\n                \"<input type='text' class='wym_alt' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Title</label><br>\" +\n                \"<input type='text' class='wym_title' value='' size='40' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var sUrl = $(wym._options.srcSelector).val();\n                    if (sUrl.length > 0) {\n                        wym._exec(WYMeditor.INSERT_IMAGE, sStamp);\n                        $(`img[src$=${sStamp}]`, wym._doc.body)\n                            .attr(WYMeditor.SRC, sUrl)\n                            .attr(WYMeditor.TITLE, $(wym._options.titleSelector).val())\n                            .attr(WYMeditor.ALT, $(wym._options.altSelector).val());\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n        return;\n    }\n\n    // TABLE DIALOG\n    if (dialogType == WYMeditor.DIALOG_TABLE) {\n        show_modal(\n            \"Table\",\n            \"<div class='row'>\" +\n                \"<label>Caption</label><br>\" +\n                \"<input type='text' class='wym_caption' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Summary</label><br>\" +\n                \"<input type='text' class='wym_summary' value='' size='40' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Rows<br></label>\" +\n                \"<input type='text' class='wym_rows' value='3' size='3' />\" +\n                \"</div>\" +\n                \"<div class='row'>\" +\n                \"<label>Number Of Cols<br></label>\" +\n                \"<input type='text' class='wym_cols' value='2' size='3' />\" +\n                \"</div>\",\n            {\n                Insert: function() {\n                    var iRows = $(wym._options.rowsSelector).val();\n                    var iCols = $(wym._options.colsSelector).val();\n\n                    if (iRows > 0 && iCols > 0) {\n                        var table = wym._doc.createElement(WYMeditor.TABLE);\n                        var newRow = null;\n                        var newCol = null;\n\n                        var sCaption = $(wym._options.captionSelector).val();\n\n                        //we create the caption\n                        var newCaption = table.createCaption();\n                        newCaption.innerHTML = sCaption;\n\n                        //we create the rows and cells\n                        for (var x = 0; x < iRows; x++) {\n                            newRow = table.insertRow(x);\n                            for (var y = 0; y < iCols; y++) {\n                                newRow.insertCell(y);\n                            }\n                        }\n\n                        //set the summary attr\n                        $(table).attr(\"summary\", $(wym._options.summarySelector).val());\n\n                        //append the table after the selected container\n                        var node = $(wym.findUp(wym.container(), WYMeditor.MAIN_CONTAINERS)).get(0);\n                        if (!node || !node.parentNode) $(wym._doc.body).append(table);\n                        else $(node).after(table);\n                    }\n                    hide_modal();\n                },\n                Cancel: function() {\n                    hide_modal();\n                }\n            }\n        );\n    }\n\n    // INSERT \"GALAXY ITEM\" LINK DIALOG\n    if (\n        dialogType == CONTROLS.DIALOG_HISTORY_LINK ||\n        dialogType == CONTROLS.DIALOG_DATASET_LINK ||\n        dialogType == CONTROLS.DIALOG_WORKFLOW_LINK ||\n        dialogType == CONTROLS.DIALOG_PAGE_LINK ||\n        dialogType == CONTROLS.DIALOG_VISUALIZATION_LINK\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_HISTORY_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_DATASET_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_WORKFLOW_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_PAGE_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_VISUALIZATION_LINK:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        var grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: `Insert Link to ${item_info.singular}`,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                        .append(\n                            `Make the selected ${item_info.plural.toLowerCase()} accessible so that they can viewed by everyone.`\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Insert: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                    // Insert links to history for each checked item.\n                    var item_ids = new Array();\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        var item_id = $(this).val();\n\n                        // Make item importable?\n                        if (make_importable) make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                        // Insert link(s) to item(s). This is done by getting item info and then manipulating wym.\n                        var url_template = get_name_and_link_url + item_id;\n                        var ajax_url = url_template.replace(\"ITEM_CONTROLLER\", item_info.controller);\n                        $.getJSON(ajax_url, returned_item_info => {\n                            // Get link text.\n                            wym._exec(WYMeditor.CREATE_LINK, sStamp);\n                            var link_text = $(`a[href=${sStamp}]`, wym._doc.body).text();\n\n                            // Insert link: need to do different actions depending on link text.\n                            if (\n                                link_text == \"\" || // Firefox.\n                                link_text == sStamp // Safari\n                            ) {\n                                // User selected no text; create link from scratch and use default text.\n                                wym.insert(\n                                    `<a href='${returned_item_info.link}'>${item_info.singular} '${\n                                        returned_item_info.name\n                                    }'</a>`\n                                );\n                            } else {\n                                // Link created from selected text; add href and title.\n                                $(`a[href=${sStamp}]`, wym._doc.body)\n                                    .attr(WYMeditor.HREF, returned_item_info.link)\n                                    .attr(WYMeditor.TITLE, item_info.singular + item_id);\n                            }\n                        });\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n    // EMBED GALAXY OBJECT DIALOGS\n    if (\n        dialogType == CONTROLS.DIALOG_EMBED_HISTORY ||\n        dialogType == CONTROLS.DIALOG_EMBED_DATASET ||\n        dialogType == CONTROLS.DIALOG_EMBED_WORKFLOW ||\n        dialogType == CONTROLS.DIALOG_EMBED_PAGE ||\n        dialogType == CONTROLS.DIALOG_EMBED_VISUALIZATION\n    ) {\n        // Based on item type, set useful vars.\n        var item_info;\n        switch (dialogType) {\n            case CONTROLS.DIALOG_EMBED_HISTORY:\n                item_info = get_item_info(CONTROLS.ITEM_HISTORY);\n                break;\n            case CONTROLS.DIALOG_EMBED_DATASET:\n                item_info = get_item_info(CONTROLS.ITEM_DATASET);\n                break;\n            case CONTROLS.DIALOG_EMBED_WORKFLOW:\n                item_info = get_item_info(CONTROLS.ITEM_WORKFLOW);\n                break;\n            case CONTROLS.DIALOG_EMBED_PAGE:\n                item_info = get_item_info(CONTROLS.ITEM_PAGE);\n                break;\n            case CONTROLS.DIALOG_EMBED_VISUALIZATION:\n                item_info = get_item_info(CONTROLS.ITEM_VISUALIZATION);\n                break;\n        }\n\n        var grid = new GridView({\n            url_base: item_info.list_ajax_url,\n            embedded: true\n        });\n        Galaxy.modal.show({\n            title: `Insert Link to ${item_info.singular}`,\n            body: $(\"<div/>\")\n                .append(grid.$el)\n                .append(\n                    $(\"<div/>\")\n                        .append('<input id=\"make-importable\" type=\"checkbox\" checked/>')\n                        .append(\n                            `Make the selected ${item_info.plural.toLowerCase()} accessible so that they can viewed by everyone.`\n                        )\n                ),\n            closing_events: true,\n            buttons: {\n                Embed: function() {\n                    // Make selected items accessible (importable) ?\n                    var make_importable = false;\n                    if ($(\"#make-importable:checked\").val() != null) make_importable = true;\n\n                    grid.$(\"input[name=id]:checked\").each(function() {\n                        // Get item ID and name.\n                        var item_id = $(this).val();\n                        // Use ':first' because there are many labels in table; the first one is the item name.\n                        var item_name = $(`label[for='${item_id}']:first`).text();\n\n                        if (make_importable) make_item_importable(item_info.controller, item_id, item_info.singular);\n\n                        // Embedded item HTML; item class is embedded in div container classes; this is necessary because the editor strips\n                        // all non-standard attributes when it returns its content (e.g. it will not return an element attribute of the form\n                        // item_class='History').\n                        var item_elt_id = `${item_info.iclass}-${item_id}`;\n                        var item_embed_html = [\n                            \"<div id='\",\n                            item_elt_id,\n                            \"' class='embedded-item \",\n                            item_info.singular.toLowerCase(),\n                            \" placeholder'>\",\n                            \"<p class='title'>\",\n                            \"Embedded Galaxy \",\n                            item_info.singular,\n                            \" '\",\n                            item_name,\n                            \"'\",\n                            \"</p>\",\n                            \"<p class='content'>\",\n                            \"[Do not edit this block; Galaxy will fill it in with the annotated \",\n                            item_info.singular.toLowerCase(),\n                            \" when it is displayed.]\",\n                            \"</p>\",\n                            \"</div>\"\n                        ].join(\"\");\n\n                        // Insert embedded item into document.\n                        wym.insert(item_embed_html);\n                    });\n                    Galaxy.modal.hide();\n                },\n                Close: function() {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    }\n};\n\nexport default function pagesEditorOnload() {\n    // Generic error handling\n    $(document).ajaxError((e, x) => {\n        // console.log( e, x );\n        var message = x.responseText || x.statusText || \"Could not connect to server\";\n        show_modal(\"Server error\", message, { \"Ignore error\": hide_modal });\n        return false;\n    });\n    // Create editor\n    $(\"[name=page_content]\").wymeditor({\n        skin: \"galaxy\",\n        basePath: editor_base_path,\n        iframeBasePath: iframe_base_path,\n        // + WYMeditor.HTML\n        boxHtml: `<table class='wym_box' width='100%' height='100%'><tr><td><div class='wym_area_top'>${\n            WYMeditor.TOOLS\n        }</div></td></tr><tr height='100%'><td><div class='wym_area_main' style='height: 100%;'>${\n            // + WYMeditor.HTML\n            WYMeditor.IFRAME\n        }${WYMeditor.STATUS}</div></div></td></tr></table>`,\n        toolsItems: [\n            { name: \"Bold\", title: \"Strong\", css: \"wym_tools_strong\" },\n            { name: \"Italic\", title: \"Emphasis\", css: \"wym_tools_emphasis\" },\n            {\n                name: \"Superscript\",\n                title: _l(\"Superscript\"),\n                css: \"wym_tools_superscript\"\n            },\n            {\n                name: \"Subscript\",\n                title: _l(\"Subscript\"),\n                css: \"wym_tools_subscript\"\n            },\n            {\n                name: \"InsertOrderedList\",\n                title: \"Ordered_List\",\n                css: \"wym_tools_ordered_list\"\n            },\n            {\n                name: \"InsertUnorderedList\",\n                title: \"Unordered_List\",\n                css: \"wym_tools_unordered_list\"\n            },\n            { name: \"Indent\", title: \"Indent\", css: \"wym_tools_indent\" },\n            { name: \"Outdent\", title: \"Outdent\", css: \"wym_tools_outdent\" },\n            { name: \"Undo\", title: \"Undo\", css: \"wym_tools_undo\" },\n            { name: \"Redo\", title: \"Redo\", css: \"wym_tools_redo\" },\n            { name: \"CreateLink\", title: \"Link\", css: \"wym_tools_link\" },\n            { name: \"Unlink\", title: \"Unlink\", css: \"wym_tools_unlink\" },\n            { name: \"InsertImage\", title: \"Image\", css: \"wym_tools_image\" },\n            { name: \"InsertTable\", title: \"Table\", css: \"wym_tools_table\" }\n        ]\n    });\n    // Get the editor object\n    var editor = $.wymeditors(0);\n    var save = callback => {\n        show_modal(\"Saving page\", \"progress\");\n\n        // Do save.\n        $.ajax({\n            url: save_url,\n            type: \"POST\",\n            data: {\n                id: page_id,\n                content: editor.xhtml(),\n                annotations: JSON.stringify(new Object()),\n                // annotations: JSON.stringify(annotations),\n                _: \"true\"\n            },\n            success: function() {\n                callback();\n            }\n        });\n    };\n    // Save button\n    $(\"#save-button\").click(() => {\n        save(() => {\n            hide_modal();\n        });\n    });\n    // Close button\n    $(\"#close-button\").click(() => {\n        // var new_content = editor.xhtml();\n        // var changed = ( initial_content != new_content );\n        var changed = false;\n        if (changed) {\n            var do_close = () => {\n                window.onbeforeunload = undefined;\n                window.document.location = page_list_url;\n            };\n            show_modal(\n                \"Close editor\",\n                \"There are unsaved changes to your page which will be lost.\",\n                {\n                    Cancel: hide_modal,\n                    \"Save Changes\": function() {\n                        save(do_close);\n                    }\n                },\n                {\n                    \"Don't Save\": do_close\n                }\n            );\n        } else {\n            window.document.location = page_list_url;\n        }\n    });\n\n    // Initialize galaxy elements.\n    //init_galaxy_elts(editor);\n\n    //\n    // Containers, Galaxy style\n    //\n    var containers_menu = $(\n        \"<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>\"\n    );\n    $(\".wym_area_top\").append(containers_menu);\n\n    // Add menu options.\n    var items = {};\n    $.each(editor._options.containersItems, (k, v) => {\n        var tagname = v.name;\n        items[v.title.replace(\"_\", \" \")] = () => {\n            editor.container(tagname);\n        };\n    });\n    make_popupmenu(containers_menu, items);\n\n    //\n    // Create 'Insert Link to Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var insert_link_menu_button = $(\n        \"<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(insert_link_menu_button);\n\n    // Add menu options.\n    make_popupmenu(insert_link_menu_button, {\n        \"Insert History Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_HISTORY_LINK);\n        },\n        \"Insert Dataset Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_DATASET_LINK);\n        },\n        \"Insert Workflow Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_WORKFLOW_LINK);\n        },\n        \"Insert Page Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_PAGE_LINK);\n        },\n        \"Insert Visualization Link\": function() {\n            editor.dialog(CONTROLS.DIALOG_VISUALIZATION_LINK);\n        }\n    });\n\n    //\n    // Create 'Embed Galaxy Object' menu.\n    //\n\n    // Add menu button.\n    var embed_object_button = $(\n        \"<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>\"\n    ).addClass(\"galaxy-page-editor-button\");\n    $(\".wym_area_top\").append(embed_object_button);\n\n    // Add menu options.\n    make_popupmenu(embed_object_button, {\n        \"Embed History\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_HISTORY);\n        },\n        \"Embed Dataset\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_DATASET);\n        },\n        \"Embed Workflow\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_WORKFLOW);\n        },\n        \"Embed Visualization\": function() {\n            editor.dialog(CONTROLS.DIALOG_EMBED_VISUALIZATION);\n        }\n        //\"Embed Page\": function() {\n        //    editor.dialog(CONTROLS.DIALOG_EMBED_PAGE);\n        //}\n    });\n}\n"]}