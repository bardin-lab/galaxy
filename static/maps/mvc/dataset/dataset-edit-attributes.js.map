{"version":3,"sources":["mvc/dataset/dataset-edit-attributes.js"],"names":["View","Backbone","extend","initialize","this","setElement","model","Model","dataset_id","Galaxy","params","message","_uiMisc2","default","Message","persistent","tabs","_createTabs","$el","append","$","hide","render","ajax","url","root","self","get","initial_message","update","response","_","forms","key","form","set","show","error","err_msg","responseJSON","success","data","create","status","_reloadHistory","operation","_getAttribute","conversion","_uiTabs2","id","add","title","_localization2","icon","tooltip","attribute","datatype","permission","ButtonIcon","_submit","operations","submit_attributes","onclick","submit_conversion","submit_datatype","submit_permission","loadCurrentHistory"],"mappings":"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","file":"../../../scripts/mvc/dataset/dataset-edit-attributes.js","sourcesContent":["import _l from \"utils/localization\";\n/** Dataset edit attributes view */\nimport Utils from \"utils/utils\";\nimport Tabs from \"mvc/ui/ui-tabs\";\nimport Ui from \"mvc/ui/ui-misc\";\nimport Form from \"mvc/form/form-view\";\nvar View = Backbone.View.extend({\n    initialize: function() {\n        this.setElement(\"<div/>\");\n        this.model = new Backbone.Model({\n            dataset_id: Galaxy.params.dataset_id\n        });\n        this.message = new Ui.Message({ persistent: true });\n        this.tabs = this._createTabs();\n        this.$el\n            .append($(\"<h4/>\").append(\"Edit dataset attributes\"))\n            .append(this.message.$el)\n            .append(\"<p/>\")\n            .append(this.tabs.$el)\n            .hide();\n        this.render();\n    },\n\n    /** fetch data for the selected dataset and build forms */\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: `${Galaxy.root}dataset/get_edit?dataset_id=${self.model.get(\"dataset_id\")}`,\n            success: function(response) {\n                !self.initial_message && self.message.update(response);\n                self.initial_message = true;\n                _.each(self.forms, (form, key) => {\n                    form.model.set(\"inputs\", response[`${key}_inputs`]);\n                    form.model.set(\"hide_operations\", response[`${key}_disable`]);\n                    form.render();\n                });\n                self.$el.show();\n            },\n            error: function(response) {\n                var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message: err_msg || \"Error occured while loading the dataset.\"\n                });\n            }\n        });\n    },\n\n    /** submit data to backend to update attributes */\n    _submit: function(operation, form) {\n        var self = this;\n        var data = form.data.create();\n        data.dataset_id = this.model.get(\"dataset_id\");\n        data.operation = operation;\n        $.ajax({\n            type: \"PUT\",\n            url: `${Galaxy.root}dataset/set_edit`,\n            data: data,\n            success: function(response) {\n                self.message.update(response);\n                self.render();\n                self._reloadHistory();\n            },\n            error: function(response) {\n                var err_msg = response.responseJSON && response.responseJSON.err_msg;\n                self.message.update({\n                    status: \"danger\",\n                    message: err_msg || \"Error occured while editing the dataset attributes.\"\n                });\n            }\n        });\n    },\n\n    /** create tabs for different dataset attribute categories*/\n    _createTabs: function() {\n        this.forms = {\n            attribute: this._getAttribute(),\n            conversion: this._getConversion(),\n            datatype: this._getDatatype(),\n            permission: this._getPermission()\n        };\n        var tabs = new Tabs.View();\n        tabs.add({\n            id: \"attribute\",\n            title: _l(\"Attributes\"),\n            icon: \"fa fa-bars\",\n            tooltip: _l(\"Edit dataset attributes\"),\n            $el: this.forms.attribute.$el\n        });\n        tabs.add({\n            id: \"convert\",\n            title: _l(\"Convert\"),\n            icon: \"fa-gear\",\n            tooltip: _l(\"Convert to new format\"),\n            $el: this.forms.conversion.$el\n        });\n        tabs.add({\n            id: \"datatype\",\n            title: _l(\"Datatypes\"),\n            icon: \"fa-database\",\n            tooltip: _l(\"Change data type\"),\n            $el: this.forms.datatype.$el\n        });\n        tabs.add({\n            id: \"permissions\",\n            title: _l(\"Permissions\"),\n            icon: \"fa-user\",\n            tooltip: _l(\"Permissions\"),\n            $el: this.forms.permission.$el\n        });\n        return tabs;\n    },\n\n    /** edit main attributes form */\n    _getAttribute: function() {\n        var self = this;\n        var form = new Form({\n            title: _l(\"Edit attributes\"),\n            operations: {\n                submit_attributes: new Ui.ButtonIcon({\n                    tooltip: _l(\"Save attributes of the dataset.\"),\n                    icon: \"fa-floppy-o\",\n                    title: _l(\"Save\"),\n                    onclick: function() {\n                        self._submit(\"attributes\", form);\n                    }\n                }),\n                submit_autodetect: new Ui.ButtonIcon({\n                    tooltip:\n                        \"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.\",\n                    icon: \"fa-undo\",\n                    title: \"Auto-detect\",\n                    onclick: function() {\n                        self._submit(\"autodetect\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** datatype conversion form */\n    _getConversion: function() {\n        var self = this;\n        var form = new Form({\n            title: _l(\"Convert to new format\"),\n            operations: {\n                submit_conversion: new Ui.ButtonIcon({\n                    tooltip: _l(\"Convert the datatype to a new format.\"),\n                    title: _l(\"Convert datatype\"),\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"conversion\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** change datatype form */\n    _getDatatype: function() {\n        var self = this;\n        var form = new Form({\n            title: _l(\"Change datatype\"),\n            operations: {\n                submit_datatype: new Ui.ButtonIcon({\n                    tooltip: _l(\"Change the datatype to a new type.\"),\n                    title: _l(\"Change datatype\"),\n                    icon: \"fa-exchange\",\n                    onclick: function() {\n                        self._submit(\"datatype\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** dataset permissions form */\n    _getPermission: function() {\n        var self = this;\n        var form = new Form({\n            title: _l(\"Manage dataset permissions\"),\n            operations: {\n                submit_permission: new Ui.ButtonIcon({\n                    tooltip: _l(\"Save permissions.\"),\n                    title: _l(\"Save permissions\"),\n                    icon: \"fa-floppy-o \",\n                    onclick: function() {\n                        self._submit(\"permission\", form);\n                    }\n                })\n            }\n        });\n        return form;\n    },\n\n    /** reload Galaxy's history after updating dataset's attributes */\n    _reloadHistory: function() {\n        if (window.Galaxy) {\n            window.Galaxy.currHistoryPanel.loadCurrentHistory();\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n"]}