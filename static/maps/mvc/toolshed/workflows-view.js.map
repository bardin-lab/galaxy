{"version":3,"sources":["mvc/toolshed/workflows-view.js"],"names":["View","Backbone","extend","el","defaults","initialize","options","that","this","model","_toolshedModel2","default","WorkflowTools","listenTo","render","fetch","workflows_missing_tools","templateWorkflows","models","$el","html","_localization2","workflows","_util2","queueLength","$","bindEvents","repository_id","title","Galaxy","root","tool_ids","queue","params","data","repository","id","new_route","toolshed","replace","history","navigate","trigger","attr","elem","api_url","tool_shed_url","get","Object","keys","metadata","current_changeset","reDraw","empty","Workflows","join"],"mappings":"oRAGIA,EAAOC,SAASD,KAAKE,QACrBC,GAAI,UAEJC,cAEAC,WAAY,SAASC,GACjB,IAAIC,EAAOC,KACXA,KAAKC,MAAQ,IAAIC,EAAAC,QAAeC,cAChCJ,KAAKK,SAASL,KAAKC,MAAO,OAAQD,KAAKM,QACvCN,KAAKC,MAAMM,QACXR,EAAKO,UAGTA,OAAQ,SAASR,GACb,IAAIC,EAAOC,KACPQ,EAA0BT,EAAKU,kBAfvCjB,EAAgBA,EAAKE,MAAdgB,OACPf,EAAIgB,IAAAC,KAiBIJ,GAfRZ,OAH4B,EAAAiB,EAAAV,SAAA,2BAoBhBW,UAAWA,EAfvBjB,MAAYkB,EAAAZ,QAAAa,iBAGRC,EAAA,WAAKZ,IAAL,WAAA,QACAN,EAAAmB,cAmBJA,WAAY,WAfZZ,IACIa,EADJb,EAAQN,KAEJiB,EAAA,iBAAIT,GAAAA,QAAAA,WACJ,IAAIM,EAAAA,EAAYf,MAAKE,KAAMS,gBAC3BX,EACIS,EAAAA,MAAAA,KAAAA,aACIY,EAAOC,OAAAC,KAAPF,2BACAN,GAAWA,SAFSS,GAGpBC,EAAAA,IAAAA,EAAOC,EAAA,SAAAC,GAJfP,EAAAO,EAAAC,WAAAC,GAOE,IAAAC,EAAAA,gBAAFC,EAAAC,QAAA,KAAA,OAAAA,QAAA,MAAA,OAAE,MACGb,EAAAA,WAALU,GAgBQnC,SAASuC,QAAQC,SAASJ,GAb1BK,SAAA,EACJnC,SAAJ,QAIIkB,EAAA,kBAAIa,GAAWb,QAAQkB,WACvB,IAAAC,EAAIC,EAAAA,MACJd,EAAIE,EAAWF,KAAAA,gBACfN,EAAMoB,EAASZ,KAAf,aACIN,EAAAA,OAAgBO,KAAhBP,2BACAM,GAAII,SAAAA,GAGJpC,EAAAA,IAAAA,EAAAA,EAASuC,SAAAA,GACLE,EAAAA,EADiCP,WAAAC,GAEjCG,GAFiCO,cAArCR,EALJX,cAAAA,GAWFF,EAAAsB,IAAAF,EAAFZ,EAAuB,SAAAC,GACfU,IACAb,EADJiB,OAAAC,KAAAf,EAAAC,WAAAe,UACe,GACXZ,EAAqBJ,EAAAC,WAAzBe,SAAAC,GACIN,EAAoBf,cAApBQ,EACAL,EAAAA,QAAWF,WAAUA,GACvBgB,EAAIF,eAIElB,EAAAA,kBAAAA,GAAAA,QAAeA,EAAAA,gBAGfyB,OAAA,SAAA9C,GACAE,KAAAW,IAAAkC,QACA7C,KAAAH,WAAAC,IAGAsC,kBAAAA,EAAAA,UAEP,yEACJ,6DACDnB,wJArEwB,SAmFpB,0BAXR2B,2HACI,WACA,4GA1EwB,iCAwFpB,OAXRnC,wCA7EJ,uCA2FY,mCACA,mCAwCRqC,oCAtCQ,sCACA,QACA,WACA,UACA,+CACA,OACA,0BACA,8BACA,2DACA,8CACA,YACA,QACA,QACA,0BACA,8BACA,uDACA,8CACA,YACA,QACA,QACA,0DACA,gEACA,2DACA,0BACA,8BACA,8BACA,kRACA,QACA,QACA,QACA,YACA,QACA,UACFC,KAAK,kBAKXD,UAAWtD","file":"../../../scripts/mvc/toolshed/workflows-view.js","sourcesContent":["import _l from \"utils/localization\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\nvar View = Backbone.View.extend({\n    el: \"#center\",\n\n    defaults: [{}],\n\n    initialize: function(options) {\n        var that = this;\n        this.model = new toolshed_model.WorkflowTools();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.fetch();\n        that.render();\n    },\n\n    render: function(options) {\n        var that = this;\n        var workflows_missing_tools = that.templateWorkflows;\n        var workflows = that.model.models;\n        that.$el.html(\n            workflows_missing_tools({\n                title: _l(\"Workflows Missing Tools\"),\n                workflows: workflows,\n                queue: toolshed_util.queueLength()\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n        that.bindEvents();\n    },\n\n    bindEvents: function() {\n        var that = this;\n        var repository_id;\n        $(\".show_wf_repo\").on(\"click\", function() {\n            var tool_ids = $(this).attr(\"data-toolids\");\n            var toolshed = $(this).attr(\"data-shed\");\n            var api_url = `${Galaxy.root}api/tool_shed/repository`;\n            var params = { tool_ids: tool_ids };\n            $.get(api_url, params, data => {\n                repository_id = data.repository.id;\n                var new_route = `repository/s/${toolshed.replace(/:/g, \"%3a\").replace(/\\//g, \"%2f\")}/r/${\n                    data.repository.id\n                }`;\n                Backbone.history.navigate(new_route, {\n                    trigger: true,\n                    replace: true\n                });\n            });\n        });\n        $(\".queue_wf_repo\").on(\"click\", function() {\n            var elem = $(this);\n            var tool_ids = elem.attr(\"data-toolids\");\n            var toolshed = elem.attr(\"data-shed\");\n            var api_url = `${Galaxy.root}api/tool_shed/repository`;\n            var params = { tool_ids: tool_ids };\n            $.get(api_url, params, data => {\n                repository_id = data.repository.id;\n                params = {\n                    tool_shed_url: toolshed,\n                    repository_id: repository_id\n                };\n                $.get(api_url, params, data => {\n                    var changesets = Object.keys(data.repository.metadata);\n                    var current_changeset = changesets[0];\n                    var current_metadata = data.repository.metadata[current_changeset];\n                    current_metadata.tool_shed_url = toolshed;\n                    toolshed_util.addToQueue(current_metadata);\n                    elem.remove();\n                });\n            });\n        });\n        $(\"#from_workflow\").on(\"click\", that.loadWorkflows);\n    },\n\n    reDraw: function(options) {\n        this.$el.empty();\n        this.initialize(options);\n    },\n\n    templateWorkflows: _.template(\n        [\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\"><%= title %></div>',\n            '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<style type=\"text/css\">',\n            \".workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }\",\n            \"</style>\",\n            '<table id=\"workflows_missing_tools\" class=\"grid\" border=\"0\" cellpadding=\"2\" cellspacing=\"2\" width=\"100%\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th class=\"datasetRow\">Workflows</th>',\n            '<th class=\"datasetRow\">Tool IDs</th>',\n            '<th class=\"datasetRow\">Shed</th>',\n            '<th class=\"datasetRow\">Name</th>',\n            '<th class=\"datasetRow\">Owner</th>',\n            '<th class=\"datasetRow\">Actions</th>',\n            \"</tr>\",\n            \"</thead>\",\n            \"<tbody>\",\n            \"<% _.each(workflows, function(workflow) { %>\",\n            \"<tr>\",\n            '<td class=\"datasetRow\">',\n            '<ul class=\"workflow_names\">',\n            '<% _.each(workflow.get(\"workflows\"), function(name) { %>',\n            '<li class=\"workflow_names\"><%= name %></li>',\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</td>\",\n            '<td class=\"datasetRow\">',\n            '<ul class=\"workflow_tools\">',\n            '<% _.each(workflow.get(\"tools\"), function(tool) { %>',\n            '<li class=\"workflow_tools\"><%= tool %></li>',\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</td>\",\n            '<td class=\"datasetRow\"><%= workflow.get(\"shed\") %></td>',\n            '<td class=\"datasetRow\"><%= workflow.get(\"repository\") %></td>',\n            '<td class=\"datasetRow\"><%= workflow.get(\"owner\") %></td>',\n            '<td class=\"datasetRow\">',\n            '<ul class=\"workflow_tools\">',\n            '<li class=\"workflow_tools\">',\n            '<input type=\"button\" class=\"show_wf_repo btn btn-primary\" data-shed=\"<%= workflow.get(\"shed\") %>\" data-owner=\"<%= workflow.get(\"owner\") %>\" data-repo=\"<%= workflow.get(\"repository\") %>\" data-toolids=\"<%= workflow.get(\"tools\").join(\",\") %>\" value=\"Show Repository\" /></li>',\n            \"</ul>\",\n            \"</td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</ul>\",\n            \"</div>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    Workflows: View\n};\n"]}