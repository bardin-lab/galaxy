{"version":3,"sources":["mvc/toolshed/repo-status-view.js"],"names":["ToolShedRepoStatusView","Backbone","View","extend","el","initialize","options","this","_","defaults","model","_toolshedModel2","default","RepoStatus","listenTo","render","url","repositories","join","fetch","timer","setInterval","self","terminal_states","all_done","some","models","repository","repo_id","get","toLowerCase","indexOf","repo_status","clearInterval","repo_status_template","templateRepoStatus","title","_localization2","queue","_util2","queueLength","$","css","bindEvents","$el","empty","template","reDraw"],"mappings":"sRAGIA,EAAyBC,SAASC,KAAKC,QACvCC,GAAI,UAEJC,WAAY,SAASC,GAEjBC,KAAKD,QAAUE,EAAEC,SAASF,KAAKD,cAAiBA,EAASC,KAAKE,UAC9DF,KAAKG,MAAQ,IAAIC,EAAAC,QAAeC,WAChCN,KAAKO,SAASP,KAAKG,MAAO,OAAQH,KAAKQ,QACvCR,KAAKG,MAAMM,KAAX,iBAAmCT,KAAKD,QAAQW,aAAaC,KAAK,KAClEX,KAAKG,MAAMS,QACXZ,KAAKa,MAAQC,YACT,SAAAC,GACI,IAAIC,GAAmB,YAAa,SAChCC,GAAW,EACfhB,EAAEiB,KAAKH,EAAKZ,MAAMgB,OAAQ,SAAAC,GACtBC,QAAUD,EAAWE,IAAI,MAfzC7B,IAAAA,EAAyBC,EAAcE,IAAd,UAAqB2B,cAC1C,IAD0C,IAAAP,EAAAQ,QAAAC,GAGlC,OAeQR,GAAW,GAfnB,IAGHd,EACAI,cAAcJ,EAAOU,OAErBV,EAAMS,MAAXA,SAIQ,IACAX,OAIQgB,MAAAA,WACAS,cAAA1B,KAAAa,QAGRL,OAAA,SAAIS,GACAS,KAAAA,QAAAA,EAAAA,OAAAA,KAAcX,QAAdhB,GACH,IAAA4B,EAAM3B,KAAA4B,mBACHb,KAAAA,IAAAA,KACHY,GAELE,OACA,EAAAC,EAAAzB,SAnBJ,qBAV0CK,aAAAV,KAAAG,MAAAgB,OA4ClCY,MAAOC,EAAA3B,QAAc4B,iBAThCC,EAnC6C,WAAAC,IAAA,WAAA,QAgD1CnC,KAAKoC,cATLA,WAAIT,aAKII,OAAAA,SAAAA,GAHiB/B,KAArBqC,IADJC,QAOAJ,KAAAA,WAAAnC,IAaJ6B,mBAAoB3B,EAAEsC,UARlB,yEApD0C,6DAgEtC,wJATRC,SACI,0BACA,oBAzD0C,4BAqEtC,qEATRZ,wBA5DJ,sCAwEY,mDACA,6CAiERtB,0FA/DQ,sEACA,kEACA,WACA,uCACA,iCACA,OACA,iEACA,wEACA,kEACA,qEACA,gFACA,QACA,WACA,+BACA,oDACA,OACA,OACA,uBACA,uFACA,gCACA,WACA,SACA,QACA,OACA,uBACA,uFACA,uCACA,WACA,SACA,QACA,OACA,uBACA,uFACA,iCACA,WACA,SACA,QACA,OACA,uBACA,4FACA,8CACA,WACA,SACA,QACA,OACA,uBACA,8FACA,qKACA,kCACA,SACA,WACA,SACA,QACA,QACA,YACA,WACA,yCACA,YACFK,KAAK,kBAKXL,WAAYb","file":"../../../scripts/mvc/toolshed/repo-status-view.js","sourcesContent":["import _l from \"utils/localization\";\nimport toolshed_model from \"mvc/toolshed/toolshed-model\";\nimport toolshed_util from \"mvc/toolshed/util\";\nvar ToolShedRepoStatusView = Backbone.View.extend({\n    el: \"#center\",\n\n    initialize: function(options) {\n        var self = this;\n        this.options = _.defaults(this.options || [{}], options, this.defaults);\n        this.model = new toolshed_model.RepoStatus();\n        this.listenTo(this.model, \"sync\", this.render);\n        this.model.url += `?repositories=${this.options.repositories.join(\"|\")}`;\n        this.model.fetch();\n        this.timer = setInterval(\n            self => {\n                var terminal_states = [\"installed\", \"error\"];\n                var all_done = true;\n                _.some(self.model.models, repository => {\n                    repo_id = repository.get(\"id\");\n                    var repo_status = repository.get(\"status\").toLowerCase();\n                    if (terminal_states.indexOf(repo_status) === -1) {\n                        all_done = false;\n                        return true;\n                    }\n                });\n                if (all_done) {\n                    clearInterval(self.timer);\n                } else {\n                    self.model.fetch();\n                }\n            },\n            2000,\n            this\n        );\n    },\n\n    close: function() {\n        clearInterval(this.timer);\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        var repo_status_template = this.templateRepoStatus;\n        this.$el.html(\n            repo_status_template({\n                title: _l(\"Repository Status\"),\n                repositories: this.model.models,\n                queue: toolshed_util.queueLength()\n            })\n        );\n        $(\"#center\").css(\"overflow\", \"auto\");\n        this.bindEvents();\n    },\n\n    bindEvents: function() {\n        var that = this;\n    },\n\n    reDraw: function(options) {\n        this.$el.empty();\n        this.initialize(options);\n    },\n\n    templateRepoStatus: _.template(\n        [\n            '<div class=\"unified-panel-header\" id=\"panel_header\" unselectable=\"on\">',\n            '<div class=\"unified-panel-header-inner\"><%= title %></div>',\n            '<div class=\"unified-panel-header-inner\" style=\"position: absolute; right: 5px; top: 0px;\"><a href=\"#/queue\">Repository Queue (<%= queue %>)</a></div>',\n            \"</div>\",\n            '<style type=\"text/css\">',\n            \".state-color-new,\",\n            \".state-color-deactivated,\",\n            \".state-color-uninstalled { border-color:#bfbfbf; background:#eee }\",\n            \".state-color-cloning,\",\n            \".state-color-setting-tool-versions,\",\n            \".state-color-installing-repository-dependencies,\",\n            \".state-color-installing-tool-dependencies,\",\n            \".state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }\",\n            \".state-color-installed { border-color:#20b520; background:#b0f1b0 }\",\n            \".state-color-error { border-color:#dd1b15; background:#f9c7c5 }\",\n            \"</style>\",\n            '<table id=\"grid-table\" class=\"grid\">',\n            '<thead id=\"grid-table-header\">',\n            \"<tr>\",\n            '<th id=\"null-header\">Name<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Description<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Owner<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Revision<span class=\"sort-arrow\"></span></th>',\n            '<th id=\"null-header\">Installation Status<span class=\"sort-arrow\"></span></th>',\n            \"</tr>\",\n            \"</thead>\",\n            '<tbody id=\"grid-table-body\">',\n            \"<% _.each(repositories, function(repository) { %>\",\n            \"<tr>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-name-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"name\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-desc-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"description\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-user-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"owner\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"repo-changeset-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"changeset_revision\") %>',\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"<td>\",\n            '<div id=\"\" class=\"\">',\n            '<label id=\"RepositoryStatus-<%= repository.get(\"id\") %>\" for=\"<%= repository.get(\"id\") %>\">',\n            '<div class=\"repo-status count-box state-color-<%= repository.get(\"status\").toLowerCase().replace(/ /g, \"-\") %>\" id=\"RepositoryStatus-<%= repository.get(\"id\") %>\">',\n            '<%= repository.get(\"status\") %>',\n            \"</div>\",\n            \"</label>\",\n            \"</div>\",\n            \"</td>\",\n            \"</tr>\",\n            \"<% }); %>\",\n            \"</tbody>\",\n            '<tfoot id=\"grid-table-footer\"></tfoot>',\n            \"</table>\"\n        ].join(\"\")\n    )\n});\n\nexport default {\n    RepoStatus: ToolShedRepoStatusView\n};\n"]}