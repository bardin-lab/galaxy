{"version":3,"sources":["mvc/history/history-content-model.js"],"names":["collectionFuzzyCountDefault","localStorage","getItem","err","HistoryContentMixin","defaults","history_id","history_content_type","hid","visible","this","get","isVisible","includeDeleted","includeHidden","idAttribute","hidden","urlRoot","Galaxy","root","url","historyId","historyContentId","historyContentType","hide","options","unhide","when","join"],"mappings":"sQAIIA,EAA8B,IAClC,IACIA,EAA8BC,aAAaC,QAAQ,gCAAkCF,EACvF,MAAOG,IAKT,IAAIC,GAEAC,UAEIC,WAAY,KAEZC,qBAAsB,KAb1BC,IAAA,KAEFC,SAAA,GAOEJ,YAAAA,UAIIE,OAAAA,WACA,OAAAG,KAAAC,IAAA,YASJC,UAAA,SAAAC,EAAAC,GACAC,IAAAA,GAAa,EAsBT,OANKF,IAAmBH,KAAKC,IAAI,aAAcD,KAAKC,IAAI,YAd5DC,GAAA,GAEAI,GAAQN,KAAWC,IAAA,aACfC,GAAQ,GAiBDA,GAMXK,QAAYC,OAAOC,KAAnB,iBAZIC,IAAA,WACIR,IAAAA,EAAAF,KAAAC,IAAA,wBACHU,EAAAX,KAAAC,IAAA,cACDW,EAAIZ,KAAmBC,IAAKA,MACxBC,EAAAA,GAAAA,KAAAA,QAAAS,EAAAT,aAAAW,EAAAX,KAAAU,EAMR,MALK,sBAAAC,IAkBGH,EAASA,EAAT,uCAAmDpB,GAb3DoB,GAIAI,KAAA,SAAAC,GACAL,OAAKV,KAAAC,IAAA,WAGDD,KAAIY,MAAAA,SAAmB,GAASG,GAF5BF,OAAAA,QAKAG,OAAA,SAAAD,GACA,OAAAf,KAAAC,IAAA,WACAS,OAAAO,OAEJjB,KAAOU,MAAPX,SAAA,GAAAgB,IAIJD,SAAM,WACF,OAAId,KAACC,IAAA,WAALD,KAA0BC,IAAA,OAAAD,KAAAC,IAAA,SAAAiB,KAAA,kBAM9BF,oBAAQtB","file":"../../../scripts/mvc/history/history-content-model.js","sourcesContent":["import STATES from \"mvc/dataset/states\";\nimport BASE_MVC from \"mvc/base-mvc\";\nimport _l from \"utils/localization\";\n\nvar collectionFuzzyCountDefault = 1000;\ntry {\n    collectionFuzzyCountDefault = localStorage.getItem(\"collectionFuzzyCountDefault\") || collectionFuzzyCountDefault;\n} catch (err) {}\n\n//==============================================================================\n/** @class Mixin for HistoryContents content (HDAs, HDCAs).\n */\nvar HistoryContentMixin = {\n    /** default attributes for a model */\n    defaults: {\n        /** parent (containing) history */\n        history_id: null,\n        /** some content_type (HistoryContents can contain mixed model classes) */\n        history_content_type: null,\n        /** indicating when/what order the content was generated in the context of the history */\n        hid: null,\n        /** whether the user wants the content shown (visible) */\n        visible: true\n    },\n\n    // ........................................................................ mixed content element\n    // In order to be part of a MIXED bbone collection, we can't rely on the id\n    //  (which may collide btwn models of different classes)\n    // Instead, use type_id which prefixes the history_content_type so the bbone collection can differentiate\n    idAttribute: \"type_id\",\n\n    // ........................................................................ common queries\n    /** the more common alias of visible */\n    hidden: function() {\n        return !this.get(\"visible\");\n    },\n\n    //TODO: remove\n    /** based on includeDeleted, includeHidden (gen. from the container control),\n     *      would this ds show in the list of ds's?\n     *  @param {Boolean} includeDeleted are we showing deleted hdas?\n     *  @param {Boolean} includeHidden are we showing hidden hdas?\n     */\n    isVisible: function(includeDeleted, includeHidden) {\n        var isVisible = true;\n        if (!includeDeleted && (this.get(\"deleted\") || this.get(\"purged\"))) {\n            isVisible = false;\n        }\n        if (!includeHidden && !this.get(\"visible\")) {\n            isVisible = false;\n        }\n        return isVisible;\n    },\n\n    // ........................................................................ ajax\n    //TODO?: these are probably better done on the leaf classes\n    /** history content goes through the 'api/histories' API */\n    urlRoot: `${Galaxy.root}api/histories/`,\n\n    /** full url spec. for this content */\n    url: function() {\n        var historyContentType = this.get(\"history_content_type\");\n        var historyId = this.get(\"history_id\");\n        var historyContentId = this.get(\"id\");\n        var url = `${this.urlRoot}${historyId}/contents/${historyContentType}s/${historyContentId}`;\n        if (historyContentType == \"dataset_collection\") {\n            // Don't fetch whole collection - just enought to render outline. Backbone will\n            // make a detailed request if any datasets are expanded beyond that point.\n            url = `${url}?view=element-reference&fuzzy_count=${collectionFuzzyCountDefault}`;\n        }\n        return url;\n    },\n\n    /** save this content as not visible */\n    hide: function(options) {\n        if (!this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: false }, options);\n    },\n    /** save this content as visible */\n    unhide: function(options) {\n        if (this.get(\"visible\")) {\n            return jQuery.when();\n        }\n        return this.save({ visible: true }, options);\n    },\n\n    // ........................................................................ misc\n    toString: function() {\n        return [this.get(\"type_id\"), this.get(\"hid\"), this.get(\"name\")].join(\":\");\n    }\n};\n\n//==============================================================================\nexport default {\n    HistoryContentMixin: HistoryContentMixin\n};\n"]}