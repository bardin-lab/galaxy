{"version":3,"sources":["mvc/ui/ui-thumbnails.js"],"names":["View","Backbone","extend","events","click .ui-thumbnails-item","dblclick .ui-thumbnails-item","initialize","options","this","model","Model","collection","Collection","get","tabs","_uiTabs2","default","setElement","$el","addClass","render","listenTo","first","delAll","_renderDefault","_renderList","_this","each","indexOf","append","$","_templateThumbnailItem","id","title","length","substr","image_src","tooltip","placement","children","add","self","_templateRegularItem","attributes","_utils2","uid","value","new_value","before","attr","removeClass","after","change_handler","_onclick","e","target","closest","_ondblclick","title_icon","description"],"mappings":"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","file":"../../../scripts/mvc/ui/ui-thumbnails.js","sourcesContent":["/** This class renders the selection grid. */\nimport Utils from \"utils/utils\";\nimport Tabs from \"mvc/ui/ui-tabs\";\n\nexport var View = Backbone.View.extend({\n    events: {\n        \"click .ui-thumbnails-item\": \"_onclick\",\n        \"dblclick .ui-thumbnails-item\": \"_ondblclick\"\n    },\n\n    initialize: function(options) {\n        this.model = options.model || new Backbone.Model(options);\n        this.collection = new Backbone.Collection(this.model.get(\"collection\"));\n        this.tabs = new Tabs.View({});\n        this.setElement(this.tabs.$el.addClass(\"ui-thumbnails\"));\n        this.render();\n        this.listenTo(this.model, \"change\", this.render, this);\n        this.listenTo(this.collection, \"reset change add remove\", this.render, this);\n    },\n\n    render: function() {\n        this.first = null;\n        this.tabs.delAll();\n        this._renderDefault();\n        this._renderList();\n    },\n\n    _renderDefault: function() {\n        var title_length = 20;\n        var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n        this.collection.each(model => {\n            if (model.get(\"keywords\").indexOf(\"default\") !== -1) {\n                var title = model.get(\"title\");\n                $el.append(\n                    $(\n                        this._templateThumbnailItem({\n                            id: model.id,\n                            title: title.length < title_length ? title : `${title.substr(0, title_length)}...`,\n                            title_icon: model.get(\"title_icon\"),\n                            image_src: model.get(\"image_src\")\n                        })\n                    ).tooltip({\n                        title: model.get(\"description\"),\n                        placement: \"bottom\"\n                    })\n                );\n            }\n        });\n        if ($el.children().length > 0) {\n            this.tabs.add({\n                id: Utils.uid(),\n                title: this.model.get(\"title_default\"),\n                $el: $el\n            });\n        }\n    },\n\n    _renderList: function() {\n        var self = this;\n        if (this.collection.length > 0) {\n            this.first = this.first || this.collection.first().id;\n            var $el = $(\"<div/>\").addClass(\"ui-thumbnails-grid\");\n            this.collection.each(model => {\n                $el.append(self._templateRegularItem(model.attributes));\n            });\n            this.tabs.add({\n                id: Utils.uid(),\n                title: self.model.get(\"title_list\"),\n                $el: $el\n            });\n        }\n    },\n\n    /** Set/Get value */\n    value: function(new_value) {\n        if (new_value !== undefined) {\n            new_value = new_value == \"__first\" ? this.first : new_value;\n            var before = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            this.$(\".ui-thumbnail-current\").removeClass(\"ui-thumbnail-current\");\n            this.$(`[value=\"${new_value}\"]`).addClass(\"ui-thumbnail-current\");\n            var after = this.$(\".ui-thumbnail-current\").attr(\"value\");\n            var change_handler = this.model.get(\"onchange\");\n            if (after != before && change_handler) {\n                change_handler(after);\n            }\n        }\n        return this.$(\".ui-thumbnail-current\").attr(\"value\");\n    },\n\n    /** Add click handler */\n    _onclick: function(e) {\n        this.value(\n            $(e.target)\n                .closest(\".ui-thumbnails-item\")\n                .attr(\"value\")\n        );\n    },\n\n    /** Add double click handler */\n    _ondblclick: function() {\n        if (this.model.get(\"ondblclick\")) {\n            this.model.get(\"ondblclick\")(this.value());\n        }\n    },\n\n    /* Thumbnail template with image */\n    _templateThumbnailItem: function(options) {\n        return `<div class=\"ui-thumbnails-item ui-thumbnails-item-float\" value=\"${\n            options.id\n        }\"><img class=\"ui-thumbnails-image\" src=\"${\n            options.image_src\n        }\"><div class=\"ui-thumbnails-title ui-form-info\"><span class=\"fa ${options.title_icon}\"/>${\n            options.title\n        }</div><div>`;\n    },\n\n    /* Thumbnail template with image and description */\n    _templateRegularItem: function(options) {\n        return `<div class=\"ui-thumbnails-item\" value=\"${\n            options.id\n        }\"><table><tr><td><img class=\"ui-thumbnails-image\" src=\"${\n            options.image_src\n        }\"></td><td><div class=\"ui-thumbnails-description-title ui-form-info\">${\n            options.title\n        }</div><div class=\"ui-thumbnails-description-text ui-form-info\">${options.description}</div></td></tr><div>`;\n    }\n});\n\nexport default { View: View };\n"]}