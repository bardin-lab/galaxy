{"version":3,"sources":["mvc/library/library-librarytoolbar-view.js"],"names":["LibraryToolbarView","Backbone","View","extend","el","defaults","search_term","events","click #create_new_library_btn","click #include_deleted_chk","click #exclude_restricted_chk","click .page_size_prompt","keyup .library-search-input","initialize","options","this","render","toolbar_template","templateToolBar","is_admin","Galaxy","user","isAdmin","is_anonym","isAnonymous","$el","html","admin_user","anon_user","find","checked","libraries","preferences","get","renderPaginator","paginator_template","parseInt","show_page","page_count","total_libraries_count","libraries_shown","library_page_size","event","modal","show","closing_events","title","_localization2","default","body","templateNewLibraryInModal","buttons","Create","self","createNewLibrary","preventDefault","stopPropagation","libraryDetails","serializeNewLibrary","Close","Library","save","success","library","libraryListView","collection","add","hide","clearLibraryModal","_toastr2","validateNewLibrary","error","response","responseJSON","showPageSizePrompt","e","prompt","set","$","val","synopsis","name","description","includeDeletedChecked","target","with_deleted","fetchDeleted","excludeRestrictedChecked","without_restricted","searchLibraries","_","template","templatePaginator","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-librarytoolbar-view.js","sourcesContent":["import _l from \"utils/localization\";\nimport mod_toastr from \"libs/toastr\";\nimport mod_library_model from \"mvc/library/library-model\";\n/**\n * This view represents the top part of the library page.\n * It contains the tool bar with controls.\n */\nvar LibraryToolbarView = Backbone.View.extend({\n    el: \"#center\",\n\n    defaults: {\n        search_term: \"\"\n    },\n\n    events: {\n        \"click #create_new_library_btn\": \"createLibraryFromModal\",\n        \"click #include_deleted_chk\": \"includeDeletedChecked\",\n        \"click #exclude_restricted_chk\": \"excludeRestrictedChecked\",\n        \"click .page_size_prompt\": \"showPageSizePrompt\",\n        \"keyup .library-search-input\": \"searchLibraries\"\n    },\n\n    initialize: function(options) {\n        this.options = _.defaults(this.options || {}, options, this.defaults);\n        this.render();\n    },\n\n    render: function() {\n        var toolbar_template = this.templateToolBar();\n        var is_admin = false;\n        var is_anonym = true;\n        if (Galaxy.user) {\n            is_admin = Galaxy.user.isAdmin();\n            is_anonym = Galaxy.user.isAnonymous();\n        }\n        this.$el.html(toolbar_template({ admin_user: is_admin, anon_user: is_anonym }));\n        if (is_admin) {\n            this.$el.find(\"#include_deleted_chk\")[0].checked = Galaxy.libraries.preferences.get(\"with_deleted\");\n            this.$el.find(\"#exclude_restricted_chk\")[0].checked = Galaxy.libraries.preferences.get(\n                \"without_restricted\"\n            );\n        }\n    },\n\n    /**\n     * Renders the element that shows pages into its div within the toolbar.\n     */\n    renderPaginator: function(options) {\n        this.options = _.extend(this.options, options);\n        var paginator_template = this.templatePaginator();\n        this.$el.find(\"#library_paginator\").html(\n            paginator_template({\n                show_page: parseInt(this.options.show_page),\n                page_count: parseInt(this.options.page_count),\n                total_libraries_count: this.options.total_libraries_count,\n                libraries_shown: this.options.libraries_shown,\n                library_page_size: Galaxy.libraries.preferences.get(\"library_page_size\")\n            })\n        );\n    },\n\n    /**\n     * User clicked on 'New library' button. Show modal to\n     * satisfy the wish.\n     */\n    createLibraryFromModal: function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        var self = this;\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Create New Library\"),\n            body: this.templateNewLibraryInModal(),\n            buttons: {\n                Create: function() {\n                    self.createNewLibrary();\n                },\n                Close: function() {\n                    self.modal.hide();\n                }\n            }\n        });\n    },\n\n    /**\n     * Create the new library using the API asynchronously.\n     */\n    createNewLibrary: function() {\n        var libraryDetails = this.serializeNewLibrary();\n        if (this.validateNewLibrary(libraryDetails)) {\n            var library = new mod_library_model.Library();\n            var self = this;\n            library.save(libraryDetails, {\n                success: function(library) {\n                    Galaxy.libraries.libraryListView.collection.add(library);\n                    self.modal.hide();\n                    self.clearLibraryModal();\n                    Galaxy.libraries.libraryListView.render();\n                    mod_toastr.success(\"Library created.\");\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occured.\");\n                    }\n                }\n            });\n        } else {\n            mod_toastr.error(\"Library's name is missing.\");\n        }\n        return false;\n    },\n\n    /**\n     * Show user the propmpt to change the number of libs shown on page.\n     */\n    showPageSizePrompt: function(e) {\n        e.preventDefault();\n        var library_page_size = prompt(\n            \"How many libraries per page do you want to see?\",\n            Galaxy.libraries.preferences.get(\"library_page_size\")\n        );\n        if (library_page_size != null && library_page_size == parseInt(library_page_size)) {\n            Galaxy.libraries.preferences.set({\n                library_page_size: parseInt(library_page_size)\n            });\n            Galaxy.libraries.libraryListView.render({ show_page: 1 });\n        }\n    },\n\n    /**\n     * Clear the library modal once it is saved.\n     */\n    clearLibraryModal: function() {\n        $(\"input[name='Name']\").val(\"\");\n        $(\"input[name='Description']\").val(\"\");\n        $(\"input[name='Synopsis']\").val(\"\");\n    },\n\n    /**\n     * Prepare new library variables to be submitted to API.\n     */\n    serializeNewLibrary: function() {\n        return {\n            name: $(\"input[name='Name']\").val(),\n            description: $(\"input[name='Description']\").val(),\n            synopsis: $(\"input[name='Synopsis']\").val()\n        };\n    },\n\n    /**\n     * Check whether entered values are valid.\n     */\n    validateNewLibrary: function(libraryDetails) {\n        return libraryDetails.name !== \"\";\n    },\n\n    /**\n     * Include or exclude deleted libraries in the view.\n     */\n    includeDeletedChecked: function(event) {\n        if (event.target.checked) {\n            Galaxy.libraries.preferences.set({ with_deleted: true });\n            Galaxy.libraries.libraryListView.fetchDeleted();\n        } else {\n            Galaxy.libraries.preferences.set({ with_deleted: false });\n            Galaxy.libraries.libraryListView.render();\n        }\n    },\n\n    /**\n     * Include or exclude restricted libraries in the view.\n     */\n    excludeRestrictedChecked: function(event) {\n        if (event.target.checked) {\n            Galaxy.libraries.preferences.set({ without_restricted: true });\n        } else {\n            Galaxy.libraries.preferences.set({ without_restricted: false });\n        }\n        Galaxy.libraries.libraryListView.render();\n    },\n\n    /**\n     * Take the contents of the search field and send it to the list view\n     * to query the collection of libraries.\n     */\n    searchLibraries: function(event) {\n        var search_term = $(\".library-search-input\").val();\n        this.options.search_term = search_term;\n        Galaxy.libraries.libraryListView.searchLibraries(search_term);\n    },\n\n    templateToolBar: function() {\n        return _.template(\n            [\n                '<div class=\"library_style_container\">',\n                '<div id=\"toolbar_form\">',\n                '<div id=\"library_toolbar\">',\n                '<form class=\"form-inline\" role=\"form\">',\n                '<span><strong><a href=\"#\" title=\"Go to first page\">DATA LIBRARIES</a></strong></span>',\n                '<span id=\"library_paginator\" class=\"library-paginator\">',\n                // paginator will append here\n                \"</span>\",\n                '<div class=\"form-group toolbar-item\">',\n                '<input type=\"text\" class=\"form-control library-search-input\" placeholder=\"Search\" size=\"30\">',\n                \"</div>\",\n                // only admins see the following\n                \"<% if(admin_user === true) { %>\",\n                '<div class=\"checkbox toolbar-item\" style=\"height: 20px;\">',\n                \"<label>\",\n                '<input id=\"include_deleted_chk\" type=\"checkbox\">',\n                \"include deleted \",\n                \"</input>\",\n                \"</label>\",\n                \"<label>\",\n                '<input id=\"exclude_restricted_chk\" type=\"checkbox\">',\n                \"exclude restricted\",\n                \"</input>\",\n                \"</label>\",\n                \"</div>\",\n                '<span class=\"toolbar-item\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Create New Library\">',\n                '<button id=\"create_new_library_btn\" class=\"primary-button btn-xs\" type=\"button\"><span class=\"fa fa-plus\"></span> New Library</button>',\n                \"</span>\",\n                \"<% } %>\",\n                '<span class=\"help-button\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"See this screen annotated\">',\n                '<a href=\"https://galaxyproject.org/data-libraries/screen/list-of-libraries/\" target=\"_blank\">',\n                '<button class=\"primary-button\" type=\"button\"><span class=\"fa fa-question-circle\"></span> Help</button>',\n                \"</a>\",\n                \"</span>\",\n                \"</form>\",\n                \"</div>\",\n                \"</div>\",\n                '<div id=\"libraries_element\">',\n                // table with libraries will append here\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templatePaginator: function() {\n        return _.template(\n            [\n                '<ul class=\"pagination pagination-sm\">',\n                \"<% if ( ( show_page - 1 ) > 0 ) { %>\",\n                \"<% if ( ( show_page - 1 ) > page_count ) { %>\", // we are on higher page than total page count\n                '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } else { %>\",\n                '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li><a href=\"#page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                \"<% } else { %>\", // we are on the first page\n                '<li class=\"disabled\"><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                '<li class=\"active\">',\n                '<a href=\"#page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n                \"</li>\",\n                \"<% if ( ( show_page ) < page_count ) { %>\",\n                '<li><a href=\"#page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"disabled\"><a href=\"#page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"disabled\"><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } %>\",\n                \"</ul>\",\n                \"<span>\",\n                ' <%- libraries_shown %> libraries shown <a href=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"currently <%- library_page_size %> per page\" class=\"page_size_prompt\">(change)</a>',\n                \"</span>\",\n                \"<span>\",\n                \" <%- total_libraries_count %> total\",\n                \"</span>\"\n            ].join(\"\")\n        );\n    },\n\n    templateNewLibraryInModal: function() {\n        return _.template(\n            [\n                '<div id=\"new_library_modal\">',\n                \"<form>\",\n                '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n                '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n                '<input type=\"text\" name=\"Synopsis\" value=\"\" placeholder=\"Synopsis\">',\n                \"</form>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    LibraryToolbarView: LibraryToolbarView\n};\n"]}