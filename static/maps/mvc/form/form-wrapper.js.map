{"version":3,"sources":["mvc/form/form-wrapper.js"],"names":["View","Backbone","extend","initialize","options","this","model","Model","url","get","redirect","setElement","render","self","$","ajax","Galaxy","root","type","attributes","response","_formView2","default","title","status","icon","initial_errors","errors","inputs","submit","_uiMisc2","Button","submit_tooltip","submit_title","submit_icon","onclick","form","$el","buttons","append","tooltip","cls","_submit","message","persistent","done","params","id","JSON","stringify","param","data","matchModel","input","input_id","field_list","value","success_message","fail","window","location","err_msg","_showMessage","indexOf","css","first","animate","scrollTop","update","$panel"],"mappings":"oOAGIA,EAAOC,SAASD,KAAKE,QACrBC,WAAY,SAASC,GACjBC,KAAKC,MAAQ,IAAIL,SAASM,MAAMH,GAChCC,KAAKG,IAAMH,KAAKC,MAAMG,IAAI,OAC1BJ,KAAKK,SAAWL,KAAKC,MAAMG,IAAI,YAC/BJ,KAAKM,WAAW,UAChBN,KAAKO,UAGTA,OAAQ,WACJ,IAAIC,EAAOR,KACXS,EAAEC,MACEP,IAAKQ,OAAOC,KAAOZ,KAAKG,IACxBU,KAAM,QAbdlB,KAAOC,SAAAA,GACPE,IAAYC,EAAAU,EAAAZ,UAASE,EAATE,MAAkBa,WAAAC,GACrBd,EAAQ,IAAAe,EAAAC,SACbC,MAAWnB,EAAWK,MACjBC,QAAWN,EAAKE,QAChBK,OAAWP,EAAhBoB,QAAA,UACKZ,KAALR,EAAAqB,KANwBC,gBAAA,EAuBZC,OAAQvB,EAAQuB,OAdxBC,OAAAxB,EAAWwB,OACXf,SACGgB,OAAA,IAAAC,EAAAR,QAAAS,QACSd,QAAOb,EADhB4B,eAEGT,MAAAnB,EAAA6B,cAAA,OAEAR,KAAArB,EAAY8B,aAAA,UACV9B,IAAYF,iCACLiC,QAAA,WACA/B,EAAQmB,QADCa,SAMhBT,EAAAA,IAAAA,QAAQvB,OAAQuB,EANAU,OAQhBC,KAAAA,SAAAA,GACIT,EAAAA,IAAAA,QAAQU,OACJC,IAAAA,EAAAA,QAAAA,SACAjB,QAAAA,2BAA+BV,EAFbL,IAElBe,IACAE,OAAAA,SACAgB,YAAK,IACLN,QAdQO,QAAA,SAApBN,GAoBAvB,IAAAA,EAAAA,KACHC,EAAAC,MAEGF,IAAAA,OAAAI,KAAAJ,EAAiB0B,IAETI,KAAAA,KAAAA,UAAAA,EAAAA,KAAAA,UACAnB,KAAAA,MACAoB,YAAAA,qBAjChBC,KAAA,SAAAzB,GAXwB,IAAA0B,KA4DZ1B,EAAS2B,GAVhBD,EAAAC,GAAA3B,EAAe2B,GAEbD,GACE9B,QAAAI,EAAmBZ,QAClBwC,OAAKC,UACLL,YAHH,GAOKE,EAAAA,SACA1B,OAAAA,SAAaJ,OAAAC,KAAAJ,EAAAH,SAAbU,IAAaN,EAAAoC,MAAAJ,IAAjBV,EAEOe,KAAAC,WAAAhC,EAAA,SAAAiC,EAAAC,GACHR,EAASS,WAAAD,GAAAE,MAAAH,EAAAG,SAELhC,EAAAA,aAAQY,EAFHqB,oBAKZC,KAAA,SAAAtC,GACDP,EAAIA,aAAJuB,GACIuB,QAAOC,EAAc5C,aAAA6C,QADzBrC,OAEO,SACHY,YAAUgB,OAKjBU,aACAJ,SAAKtB,EAAAhC,GACG0D,EAAAA,IACDnB,UACAnB,OAAAA,WACAoB,OAAY,IAAZA,OAAY,UAAAmB,QAAAjD,EAAAT,MAAA2D,IAAA,eA9BxBC,QApDwBC,SAAAC,UAAA,GAAA,KA+FxB/B,EAAKO,QAAQyB,OAAOhE,iBADpBiE,KAAAA","file":"../../../scripts/mvc/form/form-wrapper.js","sourcesContent":["/** Generic form view */\nimport Form from \"mvc/form/form-view\";\nimport Ui from \"mvc/ui/ui-misc\";\nvar View = Backbone.View.extend({\n    initialize: function(options) {\n        this.model = new Backbone.Model(options);\n        this.url = this.model.get(\"url\");\n        this.redirect = this.model.get(\"redirect\");\n        this.setElement(\"<div/>\");\n        this.render();\n    },\n\n    render: function() {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + this.url,\n            type: \"GET\"\n        })\n            .done(response => {\n                var options = $.extend({}, self.model.attributes, response);\n                var form = new Form({\n                    title: options.title,\n                    message: options.message,\n                    status: options.status || \"warning\",\n                    icon: options.icon,\n                    initial_errors: true,\n                    errors: options.errors,\n                    inputs: options.inputs,\n                    buttons: {\n                        submit: new Ui.Button({\n                            tooltip: options.submit_tooltip,\n                            title: options.submit_title || \"Save\",\n                            icon: options.submit_icon || \"fa-save\",\n                            cls: \"btn btn-primary ui-clear-float\",\n                            onclick: function() {\n                                self._submit(form);\n                            }\n                        })\n                    }\n                });\n                self.$el.empty().append(form.$el);\n            })\n            .fail(response => {\n                self.$el.empty().append(\n                    new Ui.Message({\n                        message: `Failed to load resource ${self.url}.`,\n                        status: \"danger\",\n                        persistent: true\n                    }).$el\n                );\n            });\n    },\n\n    _submit: function(form) {\n        var self = this;\n        $.ajax({\n            url: Galaxy.root + self.url,\n            data: JSON.stringify(form.data.create()),\n            type: \"PUT\",\n            contentType: \"application/json\"\n        })\n            .done(response => {\n                var params = {};\n                if (response.id) {\n                    params.id = response.id;\n                } else {\n                    params = {\n                        message: response.message,\n                        status: \"success\",\n                        persistent: false\n                    };\n                }\n                if (self.redirect) {\n                    window.location = `${Galaxy.root + self.redirect}?${$.param(params)}`;\n                } else {\n                    form.data.matchModel(response, (input, input_id) => {\n                        form.field_list[input_id].value(input.value);\n                    });\n                    self._showMessage(form, success_message);\n                }\n            })\n            .fail(response => {\n                self._showMessage(form, {\n                    message: response.responseJSON.err_msg,\n                    status: \"danger\",\n                    persistent: false\n                });\n            });\n    },\n\n    _showMessage: function(form, options) {\n        var $panel = form.$el\n            .parents()\n            .filter(function() {\n                return [\"auto\", \"scroll\"].indexOf($(this).css(\"overflow\")) != -1;\n            })\n            .first();\n        $panel.animate({ scrollTop: 0 }, 500);\n        form.message.update(options);\n    }\n});\n\nexport default {\n    View: View\n};\n"]}