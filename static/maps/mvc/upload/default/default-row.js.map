{"version":3,"sources":["mvc/upload/default/default-row.js"],"names":["Backbone","View","extend","status_classes","init","queued","running","success","error","initialize","app","options","self","this","model","setElement","_template","$mode","$","$title","$text","$size","$info_text","_uiPopover2","default","title","container","placement","default_genome","select_genome","value","default_extension","select_extension","$text_content","_uiSelect2","css","$settings","data","$symbol","list_genomes","$progress_bar","$percentage","onchange","genome","set","list_extensions","extension","on","$el","e","target","text","_removeRow","_showSettings","preventDefault","val","length","_refreshPercentage","listenTo","_refreshStatus","file_size","_refreshGenome","_refreshExtension","_refreshFileSize","render","remove","prototype","apply","_refreshType","_refreshInfo","attributes","file_name","removeClass","addClass","width","top","height","escape","file_mode","get","info","html","show","percentage","parseInt","status","enabled","attr","hide","$info_progress","indexOf","bytesToString","settings","collection","empty","append","_uploadSettings2","id"],"mappings":"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","file":"../../../../scripts/mvc/upload/default/default-row.js","sourcesContent":["import _l from \"utils/localization\";\n/** Renders the default uploader rows */\nimport Utils from \"utils/utils\";\nimport UploadModel from \"mvc/upload/upload-model\";\nimport UploadSettings from \"mvc/upload/upload-settings\";\nimport Popover from \"mvc/ui/ui-popover\";\nimport Select from \"mvc/ui/ui-select\";\nexport default Backbone.View.extend({\n    /** Dictionary of upload states and associated icons */\n    status_classes: {\n        init: \"upload-icon-button fa fa-trash-o\",\n        queued: \"upload-icon fa fa-spinner fa-spin\",\n        running: \"upload-icon fa fa-spinner fa-spin\",\n        success: \"upload-icon-button fa fa-check\",\n        error: \"upload-icon-button fa fa-exclamation-triangle\"\n    },\n\n    initialize: function(app, options) {\n        var self = this;\n        this.app = app;\n        this.model = options.model;\n        this.setElement(this._template(options.model));\n        this.$mode = this.$(\".upload-mode\");\n        this.$title = this.$(\".upload-title\");\n        this.$text = this.$(\".upload-text\");\n        this.$size = this.$(\".upload-size\");\n        this.$info_text = this.$(\".upload-info-text\");\n        this.$info_progress = this.$(\".upload-info-progress\");\n        this.$text_content = this.$(\".upload-text-content\");\n        this.$settings = this.$(\".upload-settings\");\n        this.$symbol = this.$(\".upload-symbol\");\n        this.$progress_bar = this.$(\".upload-progress-bar\");\n        this.$percentage = this.$(\".upload-percentage\");\n\n        // append popup to settings icon\n        this.settings = new Popover.View({\n            title: _l(\"Upload configuration\"),\n            container: this.$(\".upload-settings\"),\n            placement: \"bottom\"\n        });\n\n        // identify default genome and extension values\n        var default_genome = this.app.select_genome.value();\n        var default_extension = this.app.select_extension.value();\n\n        // create select genomes\n        this.select_genome = new Select.View({\n            css: \"upload-genome\",\n            data: self.app.list_genomes,\n            container: this.$(\".upload-genome\"),\n            value: default_genome,\n            onchange: function(genome) {\n                self.model.set(\"genome\", genome);\n            }\n        });\n\n        // create select extension\n        this.select_extension = new Select.View({\n            css: \"upload-extension\",\n            data: self.app.list_extensions,\n            container: this.$(\".upload-extension\"),\n            value: default_extension,\n            onchange: function(extension) {\n                self.model.set(\"extension\", extension);\n            }\n        });\n\n        // initialize genome and extension values\n        this.model.set({\n            genome: default_genome,\n            extension: default_extension\n        });\n\n        // handle click event\n        this.$symbol.on(\"click\", () => {\n            self._removeRow();\n        });\n\n        // handle extension info popover\n        this.$(\".upload-extension-info\")\n            .on(\"click\", e => {\n                self.app.showExtensionInfo({\n                    $el: $(e.target),\n                    title: self.select_extension.text(),\n                    extension: self.select_extension.value()\n                });\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // handle settings popover\n        this.$settings\n            .on(\"click\", e => {\n                self._showSettings();\n            })\n            .on(\"mousedown\", e => {\n                e.preventDefault();\n            });\n\n        // handle text editing event\n        this.$text_content.on(\"change input\", e => {\n            self.model.set({\n                url_paste: $(e.target).val(),\n                file_size: $(e.target).val().length\n            });\n        });\n\n        // model events\n        this.listenTo(this.model, \"change:percentage\", () => {\n            self._refreshPercentage();\n        });\n        this.listenTo(this.model, \"change:status\", () => {\n            self._refreshStatus();\n        });\n        this.listenTo(this.model, \"change:info\", () => {\n            self._refreshInfo();\n        });\n        this.listenTo(this.model, \"change:genome\", () => {\n            self._refreshGenome();\n        });\n        this.listenTo(this.model, \"change:extension\", () => {\n            self._refreshExtension();\n        });\n        this.listenTo(this.model, \"change:file_size\", () => {\n            self._refreshFileSize();\n        });\n    },\n\n    render: function() {\n        this._refreshType();\n        this._refreshPercentage();\n        this._refreshStatus();\n        this._refreshInfo();\n        this._refreshGenome();\n        this._refreshExtension();\n        this._refreshFileSize();\n    },\n\n    /** Remove view */\n    remove: function() {\n        this.select_genome.remove();\n        this.select_extension.remove();\n        Backbone.View.prototype.remove.apply(this);\n    },\n\n    /** Render type */\n    _refreshType: function() {\n        var options = this.model.attributes;\n        this.$title.html(_.escape(options.file_name));\n        this.$size.html(Utils.bytesToString(options.file_size));\n        this.$mode\n            .removeClass()\n            .addClass(\"upload-mode\")\n            .addClass(\"text-primary\");\n        if (options.file_mode == \"new\") {\n            this.$text\n                .css({\n                    width: `${this.$el.width() - 16}px`,\n                    top: `${this.$el.height() - 8}px`\n                })\n                .show();\n            this.$el.height(this.$el.height() - 8 + this.$text.height() + 16);\n            this.$mode.addClass(\"fa fa-edit\");\n        } else if (options.file_mode == \"local\") {\n            this.$mode.addClass(\"fa fa-laptop\");\n        } else if (options.file_mode == \"ftp\") {\n            this.$mode.addClass(\"fa fa-folder-open-o\");\n        }\n    },\n\n    /** Update extension */\n    _refreshExtension: function() {\n        this.select_extension.value(this.model.get(\"extension\"));\n    },\n\n    /** Update genome */\n    _refreshGenome: function() {\n        this.select_genome.value(this.model.get(\"genome\"));\n    },\n\n    /** Refresh info text */\n    _refreshInfo: function() {\n        var info = this.model.get(\"info\");\n        if (info) {\n            this.$info_text.html(`<strong>Failed: </strong>${info}`).show();\n        } else {\n            this.$info_text.hide();\n        }\n    },\n\n    /** Refresh percentage status */\n    _refreshPercentage: function() {\n        var percentage = parseInt(this.model.get(\"percentage\"));\n        this.$progress_bar.css({ width: `${percentage}%` });\n        this.$percentage.html(percentage != 100 ? `${percentage}%` : \"Adding to history...\");\n    },\n\n    /** Refresh status */\n    _refreshStatus: function() {\n        var status = this.model.get(\"status\");\n        this.$symbol\n            .removeClass()\n            .addClass(\"upload-symbol\")\n            .addClass(this.status_classes[status]);\n        this.model.set(\"enabled\", status == \"init\");\n        var enabled = this.model.get(\"enabled\");\n        this.$text_content.attr(\"disabled\", !enabled);\n        if (enabled) {\n            this.select_genome.enable();\n            this.select_extension.enable();\n        } else {\n            this.select_genome.disable();\n            this.select_extension.disable();\n        }\n        if (status == \"success\") {\n            this.$el.addClass(\"success\");\n            this.$percentage.html(\"100%\");\n        }\n        if (status == \"error\") {\n            this.$el.addClass(\"danger\");\n            this.$info_progress.hide();\n        }\n    },\n\n    /** Refresh file size */\n    _refreshFileSize: function() {\n        this.$size.html(Utils.bytesToString(this.model.get(\"file_size\")));\n    },\n\n    /** Remove row */\n    _removeRow: function() {\n        if ([\"init\", \"success\", \"error\"].indexOf(this.model.get(\"status\")) !== -1) {\n            this.app.collection.remove(this.model);\n        }\n    },\n\n    /** Attach file info popup */\n    _showSettings: function() {\n        if (!this.settings.visible) {\n            this.settings.empty();\n            this.settings.append(new UploadSettings(this).$el);\n            this.settings.show();\n        } else {\n            this.settings.hide();\n        }\n    },\n\n    /** View template */\n    _template: function(options) {\n        return `<tr id=\"upload-row-${\n            options.id\n        }\" class=\"upload-row\"><td><div class=\"upload-text-column\"><div class=\"upload-mode\"/><div class=\"upload-title\"/><div class=\"upload-text\"><div class=\"upload-text-info\">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class=\"upload-text-content form-control\"/></div></div></td><td><div class=\"upload-size\"/></td><td><div class=\"upload-extension\" style=\"float: left;\"/>&nbsp;&nbsp<div class=\"upload-extension-info upload-icon-button fa fa-search\"/></td><td><div class=\"upload-genome\"/></td><td><div class=\"upload-settings upload-icon-button fa fa-gear\"/></td><td><div class=\"upload-info\"><div class=\"upload-info-text\"/><div class=\"upload-info-progress progress\"><div class=\"upload-progress-bar progress-bar progress-bar-success\"/><div class=\"upload-percentage\">0%</div></div></div></td><td><div class=\"upload-symbol ${\n            this.status_classes.init\n        }\"/></td></tr>`;\n    }\n});\n"]}